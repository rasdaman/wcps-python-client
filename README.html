<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; WCPS Python Client 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
    <script src="_static/documentation_options.js?v=01f34227"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Reference" href="autoapi/index.html" />
    <link rel="prev" title="WCPS Python Client" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p>from model import MultiBand</p>
<section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h1>
<p>The <a class="reference external" href="https://www.ogc.org/standards/wcps">OGC Web Coverage Processing Service (WCPS) standard</a>
defines a protocol-independent declarative query language for the extraction,
processing, and analysis of multi-dimensional coverages (datacubes) representing
sensor, image, or statistics data.</p>
<p>This Python library allows to dynamically build WCPS queries and execute on a WCPS server.
To query a WCS server for information on available data, check the
<a class="reference external" href="https://rasdaman.github.io/wcs-python-client/">WCS Python Client</a>.</p>
</section>
<section id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">wcps</span>
</pre></div>
</div>
</section>
<section id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Link to this heading">¶</a></h1>
<section id="subsetting">
<h2>Subsetting<a class="headerlink" href="#subsetting" title="Link to this heading">¶</a></h2>
<p>Extracting spatio-temporal can be done with the subscripting operator <code class="docutils literal notranslate"><span class="pre">[]</span></code>, by specifying
lower and upper bounds for the axes we want to <em>trim</em>, or a single bound to
<em>slice</em> the axis at a particular index.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wcps.model</span> <span class="kn">import</span> <span class="n">Datacube</span>

<span class="c1"># Slice the time axis (with name ansi) at &quot;2021-04-09&quot;,</span>
<span class="c1"># and trim on the spatial axes</span>
<span class="n">cov</span> <span class="o">=</span> <span class="n">Datacube</span><span class="p">(</span><span class="s2">&quot;S2_L2A_32631_TCI_60m&quot;</span><span class="p">)[</span>
      <span class="s2">&quot;ansi&quot;</span> <span class="p">:</span> <span class="s2">&quot;2021-04-09&quot;</span><span class="p">,</span>
      <span class="s2">&quot;E&quot;</span> <span class="p">:</span> <span class="mi">669960</span> <span class="p">:</span> <span class="mi">700000</span><span class="p">,</span>
      <span class="s2">&quot;N&quot;</span> <span class="p">:</span> <span class="mi">4990200</span> <span class="p">:</span> <span class="mi">5015220</span> <span class="p">]</span>

<span class="c1"># encode final result to JPEG</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">cov</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;JPEG&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://rasdaman.github.io/wcps-python-client/autoapi/wcps/service/index.html#wcps.service.Service">Service</a>
class allows to <a class="reference external" href="https://rasdaman.github.io/wcps-python-client/autoapi/wcps/service/index.html#wcps.service.Service.execute">execute</a>
the query on the server and get back a
<a class="reference external" href="https://rasdaman.github.io/wcps-python-client/autoapi/wcps/service/index.html#wcps.service.WCPSResult">WCPSResult</a>
object. Optionally, array results can be automatically converted to a numpy array
by passing <code class="docutils literal notranslate"><span class="pre">convert_to_numpy=True</span></code> to the execute method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wcps.service</span> <span class="kn">import</span> <span class="n">Service</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="s2">&quot;https://ows.rasdaman.org/rasdaman/ows&quot;</span><span class="p">)</span>

<span class="c1"># if credentials are required:</span>
<span class="c1"># service = Service(&quot;https://ows.rasdaman.org/rasdaman/ows&quot;,</span>
<span class="c1">#                   username=..., password=...)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="c1"># or automatically convert the result to a numpy array</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">convert_to_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, the result can be saved into a file with the
<a class="reference external" href="https://rasdaman.github.io/wcps-python-client/autoapi/wcps/service/index.html#wcps.service.Service.download">download</a>
method</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">service</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="s1">&#39;tci.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>or displayed with <a class="reference external" href="https://rasdaman.github.io/wcps-python-client/autoapi/wcps/service/index.html#wcps.service.Service.show">show</a>,
mainly for demo purposes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">service</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that calling this method requires the following dependencies:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pillow</span></code> - for image results</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">netCDF4</span></code> - for netcdf results</p></li>
</ul>
</section>
<section id="geometry-clipping">
<h2>Geometry Clipping<a class="headerlink" href="#geometry-clipping" title="Link to this heading">¶</a></h2>
<p>Non-rectangular subsetting by a geometry shape can be done with
<a class="reference external" href="https://rasdaman.github.io/wcps-python-client/autoapi/wcps/model/index.html#wcps.model.Clip">Clip</a>.
It expects a WKT string describing the geometry.</p>
<p>Standard <code class="docutils literal notranslate"><span class="pre">LineString</span></code>, <code class="docutils literal notranslate"><span class="pre">Polygon</span></code>, <code class="docutils literal notranslate"><span class="pre">MultiLineString</span></code> and <code class="docutils literal notranslate"><span class="pre">MultiPolygon</span></code>
geometries are supported, and libraries such as
<a class="reference external" href="https://shapely.readthedocs.io/en/stable/geometry.html">shapely</a>
or <a class="reference external" href="https://pypi.org/project/geomet/">geomet</a> could be used to help
constructing such geometry strings.</p>
<p>More advanced geometries (non-standard WKT), are also supported in rasdaman,
in particular <code class="docutils literal notranslate"><span class="pre">Curtain</span></code> and <code class="docutils literal notranslate"><span class="pre">Corridor</span></code>; see the
<a class="reference external" href="https://doc.rasdaman.org/05_geo-services-guide.html#polygon-raster-clipping">rasdaman documentation</a>
for more details.</p>
<p>This example showcases clipping a polygon:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wcps.model</span> <span class="kn">import</span> <span class="n">Datacube</span><span class="p">,</span> <span class="n">Clip</span>

<span class="n">polygon</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;POLYGON(( 51.645 10.772, 51.018 12.551,</span>
<span class="s2">                       50.400 11.716, 50.584 10.051,</span>
<span class="s2">                       51.222 10.142, 51.551 10.522,</span>
<span class="s2">                       51.645 10.772 ))&quot;&quot;&quot;</span>
<span class="n">clip</span> <span class="o">=</span> <span class="n">Clip</span><span class="p">(</span><span class="n">Datacube</span><span class="p">(</span><span class="s2">&quot;Germany_DTM_4&quot;</span><span class="p">),</span> <span class="n">polygon</span><span class="p">)</span>

<span class="n">color_map</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;{&quot;colorMap&quot;:{&quot;type&quot;:&quot;intervals&quot;,&quot;colorTable&quot;:{&#39;</span>
             <span class="s1">&#39;&quot;0&quot;:[0,0,255,0],&quot;15&quot;:[0,140,0,255],&#39;</span>
             <span class="s1">&#39;&quot;30&quot;:[0,180,0,255],&quot;50&quot;:[255,193,0,255],&#39;</span>
             <span class="s1">&#39;&quot;100&quot;:[255,154,0,255],&quot;150&quot;:[255,116,0,255],&#39;</span>
             <span class="s1">&#39;&quot;200&quot;:[255,77,0,255],&quot;500&quot;:[255,0,0,255]}}}&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">wcps.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="s2">&quot;https://ows.rasdaman.org/rasdaman/ows&quot;</span><span class="p">)</span>
<span class="n">service</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">clip</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;image/png&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">params</span><span class="p">(</span><span class="n">color_map</span><span class="p">))</span>
</pre></div>
</div>
<p>In the next example we extract a trajectory over the Germany DEM.
The result of this WCPS query is a 1-D series of height values along
the specified LineString.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wcps.model</span> <span class="kn">import</span> <span class="n">Datacube</span><span class="p">,</span> <span class="n">Clip</span>

<span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;LineString( 52.8691 7.7124, 50.9861 6.8335,</span>
<span class="s2">                      49.5965 7.6904, 48.3562 9.0308, </span>
<span class="s2">                      48.0634 11.9531, 51.0966 13.7988,</span>
<span class="s2">                      53.3440 13.5571, 53.8914 12.3926 )&quot;&quot;&quot;</span>
<span class="n">clip</span> <span class="o">=</span> <span class="n">Clip</span><span class="p">(</span><span class="n">Datacube</span><span class="p">(</span><span class="s2">&quot;Germany_DTM_4&quot;</span><span class="p">),</span> <span class="n">line</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">wcps.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="s2">&quot;https://ows.rasdaman.org/rasdaman/ows&quot;</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">clip</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;application/json&quot;</span><span class="p">))</span>

<span class="c1"># visualize the result as a diagram; requires:</span>
<span class="c1"># pip install matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Height along linestring&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Coordinate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Height&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="band-math">
<h2>Band Math<a class="headerlink" href="#band-math" title="Link to this heading">¶</a></h2>
<p>Derive an <a class="reference external" href="https://en.wikipedia.org/wiki/Normalized_difference_vegetation_index">NDVI</a>
map from red and near-infrared bands of a Sentinel-2 datacube, threshold the very
green areas (values greater than 0.5) as true values (white in a PNG), and save
the result as a PNG image.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wcps.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">wcps.model</span> <span class="kn">import</span> <span class="n">Datacube</span><span class="p">,</span> <span class="n">Axis</span>

<span class="n">subset</span> <span class="o">=</span> <span class="p">[</span><span class="n">Axis</span><span class="p">(</span><span class="s2">&quot;ansi&quot;</span><span class="p">,</span> <span class="s2">&quot;2021-04-09&quot;</span><span class="p">),</span>
          <span class="n">Axis</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="mi">670000</span><span class="p">,</span> <span class="mi">680000</span><span class="p">),</span>
          <span class="n">Axis</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="mi">4990220</span><span class="p">,</span> <span class="mi">5000220</span><span class="p">)]</span>

<span class="n">red</span> <span class="o">=</span> <span class="n">Datacube</span><span class="p">(</span><span class="s2">&quot;S2_L2A_32631_B04_10m&quot;</span><span class="p">)[</span><span class="n">subset</span><span class="p">]</span>
<span class="n">nir</span> <span class="o">=</span> <span class="n">Datacube</span><span class="p">(</span><span class="s2">&quot;S2_L2A_32631_B08_10m&quot;</span><span class="p">)[</span><span class="n">subset</span><span class="p">]</span>

<span class="c1"># NDVI formula</span>
<span class="n">ndvi</span> <span class="o">=</span> <span class="p">(</span><span class="n">nir</span> <span class="o">-</span> <span class="n">red</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">nir</span> <span class="o">+</span> <span class="n">red</span><span class="p">)</span>
<span class="c1"># threshold NDVI values to highlight areas with high vegetation</span>
<span class="n">vegetation</span> <span class="o">=</span> <span class="n">ndvi</span> <span class="o">&gt;</span> <span class="mf">0.5</span>
<span class="c1"># encode final result to PNG</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">vegetation</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;PNG&quot;</span><span class="p">)</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="s2">&quot;https://ows.rasdaman.org/rasdaman/ows&quot;</span><span class="p">)</span>
<span class="n">service</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</pre></div>
</div>
<p>Instead of explicitly writing the NDVI formula (<code class="docutils literal notranslate"><span class="pre">ndvi</span> <span class="pre">=</span> <span class="pre">(nir</span> <span class="pre">-</span> <span class="pre">red)</span> <span class="pre">/</span> <span class="pre">(nir</span> <span class="pre">+</span> <span class="pre">red)</span></code>),
we can use the
<a class="reference external" href="https://rasdaman.github.io/wcps-python-client/autoapi/wcps/spectral/index.html#wcps.spectral.NDVI">NDVI</a>
class from the
<a class="reference external" href="https://rasdaman.github.io/wcps-python-client/autoapi/wcps/spectral/index.html">wcps.spectral</a>
module. The <code class="docutils literal notranslate"><span class="pre">wcps.spectral</span></code> module defines classes for over 200 spectral indices based on the standardized
<a class="reference external" href="https://github.com/davemlz/awesome-spectral-indices">Awesome Spectral Indices</a> list.
Given the required spectral bands, each class automatically applies the
formula to compute the respective index.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wcps.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">wcps.model</span> <span class="kn">import</span> <span class="n">Datacube</span><span class="p">,</span> <span class="n">Axis</span>
<span class="kn">from</span> <span class="nn">wcps.spectral</span> <span class="kn">import</span> <span class="n">NDVI</span>

<span class="n">subset</span> <span class="o">=</span> <span class="p">[</span><span class="n">Axis</span><span class="p">(</span><span class="s2">&quot;ansi&quot;</span><span class="p">,</span> <span class="s2">&quot;2021-04-09&quot;</span><span class="p">),</span>
          <span class="n">Axis</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="mi">670000</span><span class="p">,</span> <span class="mi">680000</span><span class="p">),</span>
          <span class="n">Axis</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="mi">4990220</span><span class="p">,</span> <span class="mi">5000220</span><span class="p">)]</span>

<span class="n">red</span> <span class="o">=</span> <span class="n">Datacube</span><span class="p">(</span><span class="s2">&quot;S2_L2A_32631_B04_10m&quot;</span><span class="p">)[</span><span class="n">subset</span><span class="p">]</span>
<span class="n">nir</span> <span class="o">=</span> <span class="n">Datacube</span><span class="p">(</span><span class="s2">&quot;S2_L2A_32631_B08_10m&quot;</span><span class="p">)[</span><span class="n">subset</span><span class="p">]</span>

<span class="c1"># spectral index class automatically applies the formula </span>
<span class="n">ndvi</span> <span class="o">=</span> <span class="n">NDVI</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">nir</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="n">red</span><span class="p">)</span>

<span class="n">vegetation</span> <span class="o">=</span> <span class="n">ndvi</span> <span class="o">&gt;</span> <span class="mf">0.5</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">vegetation</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;PNG&quot;</span><span class="p">)</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="s2">&quot;https://ows.rasdaman.org/rasdaman/ows&quot;</span><span class="p">)</span>
<span class="n">service</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively we could also use the <a class="reference external" href="https://spyndex.readthedocs.io/">spyndex</a> library
which supports the same indices list. Make sure to first install it with
<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">spyndex</span> <span class="pre">pyarrow</span> <span class="pre">setuptools</span></code>, and then we can perform the NDVI computation with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">spyndex</span>

<span class="n">ndvi</span> <span class="o">=</span> <span class="n">spyndex</span><span class="o">.</span><span class="n">computeIndex</span><span class="p">(</span><span class="s2">&quot;NDVI&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="n">nir</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">:</span> <span class="n">red</span><span class="p">})</span>
</pre></div>
</div>
</section>
<section id="composites">
<h2>Composites<a class="headerlink" href="#composites" title="Link to this heading">¶</a></h2>
<p>A <a class="reference external" href="https://en.wikipedia.org/wiki/False_color">false-color</a> composite can
be created by providing the corresponding bands in a
<a class="reference external" href="https://rasdaman.github.io/wcps-python-client/autoapi/wcps/model/index.html#wcps.model.MultiBand">MultiBand</a>
object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wcps.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">wcps.model</span> <span class="kn">import</span> <span class="n">Datacube</span><span class="p">,</span> <span class="n">MultiBand</span><span class="p">,</span> <span class="n">rgb</span>

<span class="c1"># defined in previous example</span>
<span class="n">subset</span> <span class="o">=</span> <span class="o">...</span>

<span class="n">green</span> <span class="o">=</span> <span class="n">Datacube</span><span class="p">(</span><span class="s2">&quot;S2_L2A_32631_B03_10m&quot;</span><span class="p">)[</span><span class="n">subset</span><span class="p">]</span>
<span class="n">red</span> <span class="o">=</span> <span class="n">Datacube</span><span class="p">(</span><span class="s2">&quot;S2_L2A_32631_B04_10m&quot;</span><span class="p">)[</span><span class="n">subset</span><span class="p">]</span>
<span class="n">nir</span> <span class="o">=</span> <span class="n">Datacube</span><span class="p">(</span><span class="s2">&quot;S2_L2A_32631_B08_10m&quot;</span><span class="p">)[</span><span class="n">subset</span><span class="p">]</span>

<span class="c1"># false-color composite</span>
<span class="n">false_color</span> <span class="o">=</span> <span class="n">MultiBand</span><span class="p">({</span><span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="n">nir</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="n">red</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="n">green</span><span class="p">})</span>

<span class="c1"># alternatively, use the rgb method shorthand:</span>
<span class="n">false_color</span> <span class="o">=</span> <span class="n">rgb</span><span class="p">(</span><span class="n">nir</span><span class="p">,</span> <span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">)</span>

<span class="c1"># scale the cell values to fit in the 0-255 range suitable for PNG</span>
<span class="n">scaled</span> <span class="o">=</span> <span class="n">false_color</span> <span class="o">/</span> <span class="mf">17.0</span>

<span class="c1"># execute the query on the server and show the result</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="s2">&quot;https://ows.rasdaman.org/rasdaman/ows&quot;</span><span class="p">)</span>
<span class="n">service</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">scaled</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;PNG&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="matching-resolution-projection">
<h2>Matching Resolution / Projection<a class="headerlink" href="#matching-resolution-projection" title="Link to this heading">¶</a></h2>
<p>What if the bands we want to combine come from coverages with different resolutions? We can
<a class="reference external" href="https://rasdaman.github.io/wcps-python-client/autoapi/wcps/model/index.html#wcps.model.Scale">scale</a>
the bands to a common resolution before the operations, e.g. below
we combine B12 from a 20m coverage, and B8 / B3 from a higher resolution 10m coverage.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wcps.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">wcps.model</span> <span class="kn">import</span> <span class="n">Datacube</span><span class="p">,</span> <span class="n">rgb</span>

<span class="c1"># defined in previous example</span>
<span class="n">subset</span> <span class="o">=</span> <span class="o">...</span>

<span class="n">green</span> <span class="o">=</span> <span class="n">Datacube</span><span class="p">(</span><span class="s2">&quot;S2_L2A_32631_B03_10m&quot;</span><span class="p">)[</span><span class="n">subset</span><span class="p">]</span>
<span class="n">swir</span> <span class="o">=</span> <span class="n">Datacube</span><span class="p">(</span><span class="s2">&quot;S2_L2A_32631_B12_20m&quot;</span><span class="p">)[</span><span class="n">subset</span><span class="p">]</span>
<span class="n">nir</span> <span class="o">=</span> <span class="n">Datacube</span><span class="p">(</span><span class="s2">&quot;S2_L2A_32631_B08_10m&quot;</span><span class="p">)[</span><span class="n">subset</span><span class="p">]</span>

<span class="c1"># upscale swir to match the resolution of green;</span>
<span class="c1"># interpolation is fixed to nearest-neighbour</span>
<span class="n">swir</span> <span class="o">=</span> <span class="n">swir</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">another_coverage</span><span class="o">=</span><span class="n">green</span><span class="p">)</span>

<span class="c1"># false-color composite</span>
<span class="n">composite</span> <span class="o">=</span> <span class="n">rgb</span><span class="p">(</span><span class="n">swir</span><span class="p">,</span> <span class="n">nir</span><span class="p">,</span> <span class="n">green</span><span class="p">)</span>

<span class="c1"># scale the cell values to fit in the 0-255 range suitable for PNG</span>
<span class="n">scaled</span> <span class="o">=</span> <span class="n">composite</span> <span class="o">/</span> <span class="mf">17.0</span>

<span class="c1"># execute the query on the server and show the response</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="s2">&quot;https://ows.rasdaman.org/rasdaman/ows&quot;</span><span class="p">)</span>
<span class="n">service</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">scaled</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;PNG&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>Matching different CRS projections can be done by
<a class="reference external" href="https://rasdaman.github.io/wcps-python-client/autoapi/wcps/model/index.html#wcps.model.WCPSExpr.reproject">reprojecting</a>
the operands to a common target CRS.</p>
</section>
<section id="basic-aggregation">
<h2>Basic Aggregation<a class="headerlink" href="#basic-aggregation" title="Link to this heading">¶</a></h2>
<p>We can calculate the average NDVI as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nir</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">red</span> <span class="o">=</span> <span class="o">...</span>
<span class="c1"># NDVI formula</span>
<span class="n">ndvi</span> <span class="o">=</span> <span class="p">(</span><span class="n">nir</span> <span class="o">-</span> <span class="n">red</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">nir</span> <span class="o">+</span> <span class="n">red</span><span class="p">)</span>
<span class="c1"># get average NDVI value</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">ndvi</span><span class="o">.</span><span class="n">avg</span><span class="p">()</span>

<span class="n">service</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The average NDVI is </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Other aggregation functions include <code class="docutils literal notranslate"><span class="pre">sum()</span></code>, <code class="docutils literal notranslate"><span class="pre">max()</span></code>, <code class="docutils literal notranslate"><span class="pre">min()</span></code>, <code class="docutils literal notranslate"><span class="pre">all()</span></code>, <code class="docutils literal notranslate"><span class="pre">some()</span></code>,
``</p>
</section>
<section id="timeseries-aggregation">
<h2>Timeseries Aggregation<a class="headerlink" href="#timeseries-aggregation" title="Link to this heading">¶</a></h2>
<p>A more advanced expression is the
<a class="reference external" href="https://rasdaman.github.io/wcps-python-client/autoapi/wcps/model/index.html#wcps.model.Condense">general condenser</a>
(aggregation) operation. The example calculates a map with maximum cell values across all time slices
from a 3D datacube between “2015-01-01” and “2015-07-01”, considering only the
time slices with an average greater than 20:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wcps.model</span> <span class="kn">import</span> <span class="n">Datacube</span><span class="p">,</span> <span class="n">AxisIter</span><span class="p">,</span> <span class="n">Condense</span><span class="p">,</span> <span class="n">CondenseOp</span>
<span class="kn">from</span> <span class="nn">wcps.service</span> <span class="kn">import</span> <span class="n">Service</span>

<span class="n">cov</span> <span class="o">=</span> <span class="n">Datacube</span><span class="p">(</span><span class="s2">&quot;AvgTemperatureColorScaled&quot;</span><span class="p">)</span>

<span class="c1"># iterator named ansi_iter over the subset of a temporal axis ansi</span>
<span class="n">ansi_iter</span> <span class="o">=</span> <span class="n">AxisIter</span><span class="p">(</span><span class="s2">&quot;ansi_iter&quot;</span><span class="p">,</span> <span class="s2">&quot;ansi&quot;</span><span class="p">)</span> \
            <span class="o">.</span><span class="n">of_geo_axis</span><span class="p">(</span><span class="n">cov</span><span class="p">[</span><span class="s2">&quot;ansi&quot;</span> <span class="p">:</span> <span class="s2">&quot;2015-01-01&quot;</span> <span class="p">:</span> <span class="s2">&quot;2015-07-01&quot;</span><span class="p">])</span>

<span class="n">max_map</span> <span class="o">=</span> <span class="p">(</span><span class="n">Condense</span><span class="p">(</span><span class="n">CondenseOp</span><span class="o">.</span><span class="n">MAX</span><span class="p">)</span>
           <span class="o">.</span><span class="n">over</span><span class="p">(</span> <span class="n">ansi_iter</span> <span class="p">)</span>
           <span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">cov</span><span class="p">[</span><span class="s2">&quot;ansi&quot;</span><span class="p">:</span> <span class="n">ansi_iter</span><span class="o">.</span><span class="n">ref</span><span class="p">()]</span><span class="o">.</span><span class="n">avg</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="p">)</span>
           <span class="o">.</span><span class="n">using</span><span class="p">(</span> <span class="n">cov</span><span class="p">[</span><span class="s2">&quot;ansi&quot;</span><span class="p">:</span> <span class="n">ansi_iter</span><span class="o">.</span><span class="n">ref</span><span class="p">()]</span> <span class="p">))</span>

<span class="n">query</span> <span class="o">=</span> <span class="n">max_map</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;PNG&quot;</span><span class="p">)</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="s2">&quot;https://ows.rasdaman.org/rasdaman/ows&quot;</span><span class="p">)</span>
<span class="n">service</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="s1">&#39;max_map.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>How about calculating the average of each time slice between two dates?
This can be done with a
<a class="reference external" href="https://rasdaman.github.io/wcps-python-client/autoapi/wcps/model/index.html#wcps.model.Condense">coverage constructor</a>,
which will iterate over all dates
between the two given dates, resulting in a 1D array of average NDVI values;
notice that the slicing on the time axis ansi is done with the “iterator” variable <code class="docutils literal notranslate"><span class="pre">ansi_iter</span></code>
like in the previous example. The 1D array is encoded as JSON in the end.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wcps.model</span> <span class="kn">import</span> <span class="n">Datacube</span><span class="p">,</span> <span class="n">AxisIter</span><span class="p">,</span> <span class="n">Coverage</span>
<span class="kn">from</span> <span class="nn">wcps.service</span> <span class="kn">import</span> <span class="n">Service</span>

<span class="c1"># same as in the previous example</span>
<span class="n">cov</span> <span class="o">=</span> <span class="n">Datacube</span><span class="p">(</span><span class="s2">&quot;AvgTemperatureColorScaled&quot;</span><span class="p">)</span>
<span class="n">ansi_iter</span> <span class="o">=</span> <span class="n">AxisIter</span><span class="p">(</span><span class="s2">&quot;ansi_iter&quot;</span><span class="p">,</span> <span class="s2">&quot;ansi&quot;</span><span class="p">)</span> \
            <span class="o">.</span><span class="n">of_geo_axis</span><span class="p">(</span><span class="n">cov</span><span class="p">[</span><span class="s2">&quot;ansi&quot;</span> <span class="p">:</span> <span class="s2">&quot;2015-01-01&quot;</span> <span class="p">:</span> <span class="s2">&quot;2015-07-01&quot;</span><span class="p">])</span>
<span class="n">ansi_iter_ref</span> <span class="o">=</span> <span class="n">ansi_iter</span><span class="o">.</span><span class="n">ref</span><span class="p">()</span>

<span class="c1"># compute averages per time slice</span>
<span class="n">averages</span> <span class="o">=</span> <span class="n">Coverage</span><span class="p">(</span><span class="s2">&quot;average_per_date&quot;</span><span class="p">)</span> \
           <span class="o">.</span><span class="n">over</span><span class="p">(</span> <span class="n">ansi_iter</span> <span class="p">)</span> \
           <span class="o">.</span><span class="n">values</span><span class="p">(</span> <span class="n">cov</span><span class="p">[</span><span class="s2">&quot;ansi&quot;</span><span class="p">:</span> <span class="n">ansi_iter_ref</span><span class="p">]</span><span class="o">.</span><span class="n">Red</span><span class="o">.</span><span class="n">avg</span><span class="p">()</span> <span class="p">)</span>

<span class="n">query</span> <span class="o">=</span> <span class="n">averages</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;JSON&quot;</span><span class="p">)</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="s2">&quot;https://ows.rasdaman.org/rasdaman/ows&quot;</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

<span class="c1"># print result</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

<span class="c1"># visualize the result as a diagram; requires:</span>
<span class="c1"># pip install matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Average per Date&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date Index&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The returned JSON list contains only the average values, and not the
datetimes to which these correspond. As a result, the “Date Index” on the
X axis are just numbers from 0 to 6.</p>
<p>To get the date values, we can use the
<a class="reference external" href="https://rasdaman.github.io/wcs-python-client/">WCS Python Client</a>.
Make sure to install it first with <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">wcs</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wcs.service</span> <span class="kn">import</span> <span class="n">WebCoverageService</span>

<span class="c1"># get a coverage object that can be inspected for information</span>
<span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;https://ows.rasdaman.org/rasdaman/ows&quot;</span>
<span class="n">wcs_service</span> <span class="o">=</span> <span class="n">WebCoverageService</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
<span class="n">cov</span> <span class="o">=</span> <span class="n">wcs_service</span><span class="o">.</span><span class="n">list_full_info</span><span class="p">(</span><span class="s1">&#39;AvgTemperatureColorScaled&#39;</span><span class="p">)</span>

<span class="c1"># ansi is an irregular axis in this coverage, and we can get the</span>
<span class="c1"># coefficients within the subset above with the [] operator</span>
<span class="n">subset_dates</span> <span class="o">=</span> <span class="n">cov</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">ansi</span><span class="p">[</span><span class="s2">&quot;2015-01-01&quot;</span> <span class="p">:</span> <span class="s2">&quot;2015-07-01&quot;</span><span class="p">]</span>

<span class="c1"># visualize the result as a diagram</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subset_dates</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Average per Date&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="convolution">
<h2>Convolution<a class="headerlink" href="#convolution" title="Link to this heading">¶</a></h2>
<p>The <a class="reference external" href="https://rasdaman.github.io/wcps-python-client/autoapi/wcps/model/index.html#wcps.model.Condense">coverage constructor</a>
supports also enumerating the cell values in place as a list of numbers.
This allows to specify small arrays such as
<a class="reference external" href="https://en.wikipedia.org/wiki/Kernel_(image_processing)">convolution kernels</a>,
enabling more advanced image processing operation. The example below uses a
<a class="reference external" href="https://en.wikipedia.org/wiki/Sobel_operator">Sobel operator</a>
to perform edge detection on an image on the server, before downloading the result.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wcps.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">wcps.model</span> <span class="kn">import</span> <span class="n">Datacube</span><span class="p">,</span> <span class="n">Coverage</span><span class="p">,</span> <span class="n">Condense</span><span class="p">,</span> \
    <span class="n">AxisIter</span><span class="p">,</span> <span class="n">CondenseOp</span>

<span class="c1"># kernels</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">AxisIter</span><span class="p">(</span><span class="s1">&#39;$x&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">AxisIter</span><span class="p">(</span><span class="s1">&#39;$y&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">kernel1</span> <span class="o">=</span> <span class="p">(</span><span class="n">Coverage</span><span class="p">(</span><span class="s1">&#39;kernel1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
           <span class="o">.</span><span class="n">value_list</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">kernel2</span> <span class="o">=</span> <span class="p">(</span><span class="n">Coverage</span><span class="p">(</span><span class="s1">&#39;kernel2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
           <span class="o">.</span><span class="n">value_list</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

<span class="c1"># coverage axis iterators</span>
<span class="n">cov</span> <span class="o">=</span> <span class="n">Datacube</span><span class="p">(</span><span class="s2">&quot;NIR&quot;</span><span class="p">)</span>
<span class="n">subset</span> <span class="o">=</span> <span class="p">[(</span> <span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">500</span> <span class="p">),</span> <span class="p">(</span> <span class="s2">&quot;j&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">500</span> <span class="p">)]</span>
<span class="n">cx</span> <span class="o">=</span> <span class="n">AxisIter</span><span class="p">(</span><span class="s1">&#39;$px&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">of_grid_axis</span><span class="p">(</span><span class="n">cov</span><span class="p">[</span><span class="n">subset</span><span class="p">])</span>
<span class="n">cy</span> <span class="o">=</span> <span class="n">AxisIter</span><span class="p">(</span><span class="s1">&#39;$py&#39;</span><span class="p">,</span> <span class="s1">&#39;j&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">of_grid_axis</span><span class="p">(</span><span class="n">cov</span><span class="p">[</span><span class="n">subset</span><span class="p">])</span>

<span class="c1"># kernel axis iterators</span>
<span class="n">kx</span> <span class="o">=</span> <span class="n">AxisIter</span><span class="p">(</span><span class="s1">&#39;$kx&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ky</span> <span class="o">=</span> <span class="n">AxisIter</span><span class="p">(</span><span class="s1">&#39;$ky&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">gx</span> <span class="o">=</span> <span class="p">(</span><span class="n">Coverage</span><span class="p">(</span><span class="s1">&#39;Gx&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">([</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">])</span>
      <span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">Condense</span><span class="p">(</span><span class="n">CondenseOp</span><span class="o">.</span><span class="n">PLUS</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">([</span><span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">])</span>
              <span class="o">.</span><span class="n">using</span><span class="p">(</span><span class="n">kernel1</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">kx</span><span class="o">.</span><span class="n">ref</span><span class="p">(),</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">ky</span><span class="o">.</span><span class="n">ref</span><span class="p">()]</span> <span class="o">*</span>
                     <span class="n">cov</span><span class="o">.</span><span class="n">green</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">:</span> <span class="n">cx</span><span class="o">.</span><span class="n">ref</span><span class="p">()</span> <span class="o">+</span> <span class="n">kx</span><span class="o">.</span><span class="n">ref</span><span class="p">(),</span>
                               <span class="s2">&quot;j&quot;</span><span class="p">:</span> <span class="n">cy</span><span class="o">.</span><span class="n">ref</span><span class="p">()</span> <span class="o">+</span> <span class="n">ky</span><span class="o">.</span><span class="n">ref</span><span class="p">()])</span>
              <span class="p">)</span>
      <span class="p">)</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>

<span class="n">gy</span> <span class="o">=</span> <span class="p">(</span><span class="n">Coverage</span><span class="p">(</span><span class="s1">&#39;Gy&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">([</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">])</span>
      <span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">Condense</span><span class="p">(</span><span class="n">CondenseOp</span><span class="o">.</span><span class="n">PLUS</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">([</span><span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">])</span>
              <span class="o">.</span><span class="n">using</span><span class="p">(</span><span class="n">kernel2</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">kx</span><span class="o">.</span><span class="n">ref</span><span class="p">(),</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">ky</span><span class="o">.</span><span class="n">ref</span><span class="p">()]</span> <span class="o">*</span>
                     <span class="n">cov</span><span class="o">.</span><span class="n">green</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">:</span> <span class="n">cx</span><span class="o">.</span><span class="n">ref</span><span class="p">()</span> <span class="o">+</span> <span class="n">kx</span><span class="o">.</span><span class="n">ref</span><span class="p">(),</span>
                               <span class="s2">&quot;j&quot;</span><span class="p">:</span> <span class="n">cy</span><span class="o">.</span><span class="n">ref</span><span class="p">()</span> <span class="o">+</span> <span class="n">ky</span><span class="o">.</span><span class="n">ref</span><span class="p">()])</span>
              <span class="p">)</span>
      <span class="p">)</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>

<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">gx</span> <span class="o">+</span> <span class="n">gy</span><span class="p">)</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;image/jpeg&quot;</span><span class="p">)</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="s2">&quot;https://ows.rasdaman.org/rasdaman/ows&quot;</span><span class="p">)</span>
<span class="n">service</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="s1">&#39;convolution.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="case-distinction">
<h2>Case Distinction<a class="headerlink" href="#case-distinction" title="Link to this heading">¶</a></h2>
<p>Conditional evaluation is possible with
<a class="reference external" href="https://rasdaman.github.io/wcps-python-client/autoapi/wcps/model/index.html#wcps.model.Switch">Switch</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wcps.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">wcps.model</span> <span class="kn">import</span> <span class="n">Datacube</span><span class="p">,</span> <span class="n">Switch</span><span class="p">,</span> <span class="n">rgb</span>

<span class="n">cov</span> <span class="o">=</span> <span class="n">Datacube</span><span class="p">(</span><span class="s2">&quot;AvgLandTemp&quot;</span><span class="p">)[</span><span class="s2">&quot;ansi&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-07&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;Lat&quot;</span><span class="p">:</span> <span class="mi">35</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
                              <span class="s2">&quot;Long&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">20</span><span class="p">:</span> <span class="mi">40</span><span class="p">]</span>
<span class="n">switch</span> <span class="o">=</span> <span class="p">(</span><span class="n">Switch</span><span class="p">()</span>
          <span class="o">.</span><span class="n">case</span><span class="p">(</span><span class="n">cov</span> <span class="o">==</span> <span class="mi">99999</span><span class="p">)</span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">rgb</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
          <span class="o">.</span><span class="n">case</span><span class="p">(</span><span class="n">cov</span> <span class="o">&lt;</span> <span class="mi">18</span><span class="p">)</span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">rgb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
          <span class="o">.</span><span class="n">case</span><span class="p">(</span><span class="n">cov</span> <span class="o">&lt;</span> <span class="mi">23</span><span class="p">)</span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">rgb</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
          <span class="o">.</span><span class="n">case</span><span class="p">(</span><span class="n">cov</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">rgb</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
          <span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">rgb</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>

<span class="n">query</span> <span class="o">=</span> <span class="n">switch</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;image/png&quot;</span><span class="p">)</span>

<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="s2">&quot;https://ows.rasdaman.org/rasdaman/ows&quot;</span><span class="p">)</span>
<span class="n">service</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="user-defined-functions-udf">
<h2>User-Defined Functions (UDF)<a class="headerlink" href="#user-defined-functions-udf" title="Link to this heading">¶</a></h2>
<p>UDFs can be executed with the
<a class="reference external" href="https://rasdaman.github.io/wcps-python-client/autoapi/wcps/model/index.html#wcps.model.Udf">Udf</a>
object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wcps.service</span> <span class="kn">import</span> <span class="n">Service</span>
<span class="kn">from</span> <span class="nn">wcps.model</span> <span class="kn">import</span> <span class="n">Datacube</span><span class="p">,</span> <span class="n">Udf</span>

<span class="n">cov</span> <span class="o">=</span> <span class="n">Datacube</span><span class="p">(</span><span class="s2">&quot;S2_L2A_32631_B04_10m&quot;</span><span class="p">)[</span>
      <span class="s2">&quot;ansi&quot;</span> <span class="p">:</span> <span class="s2">&quot;2021-04-09&quot;</span><span class="p">,</span>
      <span class="s2">&quot;E&quot;</span> <span class="p">:</span> <span class="mi">670000</span> <span class="p">:</span> <span class="mi">680000</span><span class="p">,</span>
      <span class="s2">&quot;N&quot;</span> <span class="p">:</span> <span class="mi">4990220</span> <span class="p">:</span> <span class="mi">5000220</span> <span class="p">]</span>

<span class="c1"># Apply the image.stretch(cov) UDF to stretch the values of</span>
<span class="c1"># cov in the [0-255] range, so it can be encoded in JPEG</span>
<span class="n">stretched</span> <span class="o">=</span> <span class="n">Udf</span><span class="p">(</span><span class="s1">&#39;image.stretch&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">cov</span><span class="p">])</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;JPEG&quot;</span><span class="p">)</span>

<span class="c1"># execute the query on the server and show the result</span>
<span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="s2">&quot;https://ows.rasdaman.org/rasdaman/ows&quot;</span><span class="p">)</span>
<span class="n">service</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">stretched</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="contributing">
<h1>Contributing<a class="headerlink" href="#contributing" title="Link to this heading">¶</a></h1>
<p>The directory structure is as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">wcps</span></code> - the main library code</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tests</span></code> - testing code</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docs</span></code> - documentation in reStructuredText format</p></li>
</ul>
<section id="tests">
<h2>Tests<a class="headerlink" href="#tests" title="Link to this heading">¶</a></h2>
<p>To run the tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># install dependencies</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">wcps</span><span class="p">[</span><span class="n">tests</span><span class="p">]</span>

<span class="n">pytest</span>
</pre></div>
</div>
</section>
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Link to this heading">¶</a></h2>
<p>To build the documentation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># install dependencies</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">wcps</span><span class="p">[</span><span class="n">docs</span><span class="p">]</span>

<span class="n">cd</span> <span class="n">docs</span>
<span class="n">make</span> <span class="n">html</span>
</pre></div>
</div>
<p>The built documentation can be found in the <code class="docutils literal notranslate"><span class="pre">docs/_build/html/</span></code> subdir.</p>
</section>
</section>
<section id="acknowledgments">
<h1>Acknowledgments<a class="headerlink" href="#acknowledgments" title="Link to this heading">¶</a></h1>
<p>Created in project <a class="reference external" href="https://fairicube.nilu.no/">EU FAIRiCUBE</a>, with funding from the
Horizon Europe programme under grant agreement No 101059238.</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">WCPS Python Client</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="#examples">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#subsetting">Subsetting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#geometry-clipping">Geometry Clipping</a></li>
<li class="toctree-l2"><a class="reference internal" href="#band-math">Band Math</a></li>
<li class="toctree-l2"><a class="reference internal" href="#composites">Composites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#matching-resolution-projection">Matching Resolution / Projection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basic-aggregation">Basic Aggregation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#timeseries-aggregation">Timeseries Aggregation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#convolution">Convolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#case-distinction">Case Distinction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#user-defined-functions-udf">User-Defined Functions (UDF)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#contributing">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#tests">Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#documentation">Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#acknowledgments">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="autoapi/index.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">WCPS Python Client</a></li>
      <li>Next: <a href="autoapi/index.html" title="next chapter">API Reference</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, rasdaman team.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>